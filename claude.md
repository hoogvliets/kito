# kito - Claude Code Reference Document

*Last updated: 2025-12-11*

## Project Overview

**kito** is a self-hosted personal newsfeed aggregator and customizable dashboard. It combines RSS feed reading with a widget-based home screen, all running client-side with data fetched via GitHub Actions.

**Key Concept**: This is a zero-infrastructure personal dashboard that runs entirely on GitHub Pages, with automated data fetching via GitHub Actions. No backend server required.

## Architecture & Tech Stack

- **Frontend**: Vanilla JavaScript (ES6+), HTML5, CSS3
- **Styling**: Custom CSS with CSS variables for theming
- **Storage**: Browser LocalStorage
- **Data Source**: Static JSON files (generated by GitHub Actions)
- **Weather API**: Open-Meteo (free, no API key)
- **Favicon Service**: Google Favicon API
- **Deployment**: GitHub Pages
- **Automation**: GitHub Actions (scheduled cron jobs)

## File Structure

```
/
├── index.html           # Main HTML file with templates
├── css/
│   └── styles.css       # All styling including themes
├── js/
│   └── app.js          # Main application logic (~1644 lines)
├── data/               # JSON feed data (generated by Actions)
│   ├── feed.json       # Tech feed
│   ├── news.json       # News feed
│   ├── ball.json       # Sports feed
│   └── sidebar.json    # Hacker News sidebar
├── scripts/            # Python data processing scripts
├── config/             # Feed configuration files (YAML)
└── .github/workflows/  # GitHub Actions for automation
```

## Core Application State

The entire app state lives in a single `state` object (js/app.js:3-35):

```javascript
const state = {
    tech: [],              // Tech feed articles
    news: [],              // News feed articles
    ball: [],              // Sports feed articles
    sidebar: [],           // Hacker News items
    widgets: [],           // User's widgets (bookmarks, notes, etc.)
    activeFeed,            // Computed: current view's feed
    filteredFeed: [],      // After applying filters
    page: 1,               // Infinite scroll pagination
    itemsPerPage: 10,
    loading: false,
    hasMore: true,
    filters: {
        source: 'all',
        favoritesOnly: false
    },
    userSettings: {
        read: [],          // Article IDs marked as read
        favorites: [],     // Article IDs favorited
        hidden: [],        // Article IDs hidden
        theme: 'light',    // 'light' or 'dark'
    },
    currentView: 'home',   // 'home' | 'tech' | 'news' | 'ball' | 'config'
    currentWidgetId: null, // For modal context
    draggedWidget: null    // For drag-and-drop
};
```

## View System

The app has 5 main views:
1. **Home** (`view-home`) - Widget dashboard
2. **Tech** (`view-tech`) - Tech news feed + sidebar
3. **News** (`view-news`) - General news feed + sidebar
4. **Ball** (`view-ball`) - Sports feed + sidebar
5. **Config** (`view-config`) - Configuration management

Navigation: `switchView(viewName)` (js/app.js:200-229)

## Widget System

### Widget Types

All widgets stored in `state.widgets` array and persisted to `localStorage['widgets-data']`.

**5 Widget Types:**
1. **Bookmarks** - List of titled links
2. **Launchpad** - Visual grid of site favicons (3x3)
3. **Notes** - Simple textarea for notes
4. **Weather** - Current weather + 4-hour forecast
5. **Todo** - Task list with checkboxes

### Widget Schema

```javascript
{
    id: "timestamp",
    type: "bookmarks|launchpad|notes|weather|todo",
    title: "Widget Title",

    // Type-specific fields:
    links: [...],      // bookmarks only
    sites: [...],      // launchpad only
    notes: "...",      // notes only
    location: "...",   // weather only
    weather: {...},    // weather only (not exported)
    todos: [...]       // todo only
}
```

### Widget Operations

- **Create**: `saveWidget()` (js/app.js:624)
- **Delete**: `deleteWidget(widgetId)` (js/app.js:662)
- **Render**: `renderWidgets()` (js/app.js:795)
- **Drag & Drop**: `handleDragStart/End/Over/Drop()` (js/app.js:1189-1221)

### Weather Widget

Uses **Open-Meteo API** (free, no key required):
1. Geocode location: `https://geocoding-api.open-meteo.com/v1/search`
2. Fetch weather: `https://api.open-meteo.com/v1/forecast`

Function: `fetchWeather(widgetId, location)` (js/app.js:1224-1303)

Weather data is NOT exported in config (too volatile). Only location is saved.

## Feed System

### Data Flow

1. **GitHub Actions** runs Python scripts (every 3 hours)
2. Scripts fetch RSS feeds, parse, and generate JSON
3. JSON files committed to repo (`data/*.json`)
4. GitHub Pages serves updated files
5. Frontend fetches JSON on load: `fetchData()` (js/app.js:233-290)

### Feed Item Schema

```javascript
{
    id: "unique-id",
    title: "Article Title",
    link: "https://...",
    summary: "Description...",
    author: "Author Name",
    source: "Source Name",
    published: "ISO-8601 date",
    image: "https://..." // optional
}
```

### Feed Features

- **Filtering**: By source, favorites only
- **Actions**: Read, favorite, hide
- **Infinite Scroll**: Intersection Observer (js/app.js:436-462)
- **Dual Columns**: Main feed + Hacker News sidebar

## Configuration Import/Export

**Format**: YAML (custom parser/stringifier)

**Functions**:
- Export: `exportConfig()` → Downloads `.yaml` file
- Import: `importConfig(yamlText)` → Restores from YAML
- Copy/Paste: Clipboard integration

**What's Exported**:
- All widgets (except weather data)
- User settings (theme, read/favorites/hidden arrays)
- Metadata (version, export timestamp)

**Location**: Config Manager view (js/app.js:1328-1640)

## Local Storage

**Keys Used**:
1. `widgets-data` - JSON array of widget objects
2. `newsfeed-settings` - User settings object

**Schema**:
```javascript
// widgets-data
[
  { id, type, title, ... },
  ...
]

// newsfeed-settings
{
  read: ["id1", "id2"],
  favorites: ["id1"],
  hidden: ["id3"],
  theme: "light|dark"
}
```

## Theming

**Implementation**: CSS custom properties + `data-theme` attribute

Toggle: `toggleTheme()` (js/app.js:1322-1326)

Themes defined in `css/styles.css` using `:root[data-theme="dark"]` selectors.

## Templates

HTML templates defined in `<template>` tags (index.html:302-591):
- `feed-item-template` - Feed article cards
- `sidebar-item-template` - Sidebar items
- `widget-*-template` - Each widget type
- `bookmark-link-template` - Bookmark items
- `launchpad-item-template` - Launchpad sites
- `todo-item-template` - Todo tasks
- `weather-hourly-item-template` - Weather hourly forecasts

Cloned and populated via `document.importNode()` / `.cloneNode(true)`

## Key Functions Reference

### Initialization
- `init()` (js/app.js:95) - App entry point
- `setupEventListeners()` (js/app.js:109) - Wire up UI events
- `setupWidgetListeners()` (js/app.js:168) - Widget-specific events

### Rendering
- `renderFeed(append)` (js/app.js:294) - Render article feed
- `renderSidebar()` (js/app.js:385) - Render HN sidebar
- `renderWidgets()` (js/app.js:795) - Render widget grid

### Data
- `fetchData()` (js/app.js:233) - Load all JSON feeds
- `applyFilters()` (js/app.js:466) - Filter feed by criteria
- `populateSourceFilter()` (js/app.js:491) - Update source dropdown

### User Actions
- `toggleFavorite(id, btn)` (js/app.js:549)
- `hidePost(id, card)` (js/app.js:565)
- `toggleRead(id, card)` (js/app.js:579)
- `handleLinkClick(e, id, card)` (js/app.js:540) - Auto-mark as read

### Persistence
- `loadSettings()` (js/app.js:1307)
- `saveSettings()` (js/app.js:1314)
- `loadWidgets()` (js/app.js:593)
- `saveWidgets()` (js/app.js:606)

## Development Notes

### Current Branch
- Working on: `fix/feed` (has uncommitted changes to `js/app.js`)
- Main branch: `main`

### Common Development Tasks

**Adding a new feed:**
1. Add config to `config/*.yaml`
2. Update GitHub Actions workflow
3. Add new state property (e.g., `state.myFeed`)
4. Add fetch logic in `fetchData()`
5. Add view in HTML
6. Add navigation logic

**Adding a new widget type:**
1. Add template to `index.html`
2. Add type to widget modal dropdown
3. Update `saveWidget()` schema
4. Add rendering logic in `renderWidgets()`
5. Add any specific handlers (edit, delete, etc.)

**Styling:**
- All styles in `css/styles.css`
- Use CSS variables for theming
- Light/dark themes via `[data-theme]` selector

### Known Patterns

1. **DOM Updates**: Always call `saveWidgets()` or `saveSettings()` after state changes
2. **Re-rendering**: Most functions call `renderWidgets()` or `applyFilters()` after changes
3. **Modals**: Use `.classList.add/remove('hidden')` pattern
4. **IDs**: Use `Date.now().toString()` for new item IDs
5. **Templates**: Clone with `.content.cloneNode(true)`, populate, then append

### Potential Improvements

- [ ] Add widget categories/folders
- [ ] RSS feed widget (display any RSS feed)
- [ ] Search functionality across feeds
- [ ] Keyboard shortcuts
- [ ] Export/import favorites separately
- [ ] Calendar widget
- [ ] Custom CSS per widget
- [ ] Widget resize/custom grid layout
- [ ] PWA/offline support

## Important Constraints

1. **No npm dependencies** - Pure vanilla JS
2. **No build process** - Everything runs in browser
3. **Static files only** - No server-side processing
4. **LocalStorage limits** - ~5-10MB total
5. **CORS** - Weather API and Favicons must support CORS
6. **GitHub Pages** - Static hosting only

## Debugging Tips

1. **Check console logs** - Heavy use of `console.log()` throughout
2. **LocalStorage inspector** - View `widgets-data` and `newsfeed-settings`
3. **Network tab** - Check JSON feed loads and weather API calls
4. **Test import/export** - Good way to inspect data structure
5. **Breakpoints in renderWidgets()** - Most complex rendering logic

## Server Setup

**Local Development:**
```bash
# Port 5500 (as currently running)
python3 -m http.server 5500
```

Then visit: http://localhost:5500

**Data Processing** (requires Python):
```bash
python3 scripts/process_data.py
```

## Git Workflow

Current uncommitted changes in `js/app.js` on branch `fix/feed`.

Standard workflow:
1. Make changes
2. Test locally
3. Commit to feature branch
4. Merge to `main`
5. GitHub Actions auto-deploys to Pages

---

*This document is for Claude Code's reference to understand the project architecture and make informed development decisions.*
